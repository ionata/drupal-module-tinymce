<?php
// $Id$

function tinymce_help($section) {
  switch ($section) {
    case 'admin/help#tinymce':
      $output = '<p>'. t('The most popular WYSIWYG editor for advance content.') .'</p>';
      $output .= t("<p><ul>"
				  ."<li>Editor mode: full, compact and simple.</li>"
				  ."</ul>"
				  ."</p>");
      return $output;
    case 'admin/modules#description':
      return t('Enable WYSIWYG Editor to your site.');
  }
}

function tinymce_perm() {
  $array = array('administer tinymce', 'access tinymce');
  $array[] = 'enable tinymce file manager';
  
  return $array;
}

function tinymce_menu($may_cache) {

  $items = array();
  
  $items[] = array(
      'path' => 'admin/settings/tinymce',
      'title' => t('TinyMCE'),
      'description' => t('Tinymce settings.'),
      'callback' => 'drupal_get_form',
      'callback arguments' => array('tinymce_admin_settings'),
      'access' => user_access('administer tinymce'),
      'type' => MENU_NORMAL_ITEM);
      
  return $items;
}

function tinymce_admin_settings() {
  // only administrators can access this function
  // Generate the form - settings applying to all patterns first
  
  $form['tinymce_settings'] = array(
    '#type' => 'fieldset',
    '#weight' => -20,
    '#title' => t('Basic settings'),
    '#collapsible' => TRUE,
    '#collapsed' => FALSE
  );
    
  $form['tinymce_settings']['editor_mode'] = array(
    '#type' => 'radios',
    '#title' => t('Editor Mode'),
	'#default_value' => variable_get('editor_mode', 0),
	'#options' => array(t('Full'), t('Compact'), t('Simple')), 
    '#description' => t("FULL: enable all TinyMCE features. COMPACT: enable most used features. SIMPLE: just enable simple editor.")
	);
  
  return system_settings_form($form);
}

function tinymce_form_alter($form_id, &$form) {
  if ($form_id == 'comment_form' || (isset($form['type']) && $form['type']['#value'] .'_node_form' == $form_id) && user_access('access tinymce')) {
    $queries = array("textarea#body", "textarea#comment");
    tinymce_add_javascript();
  }
}

function tinymce_add_javascript() {
  $editor_mode  = variable_get("editor_mode", 0); 
  
  drupal_add_js(drupal_get_path('module', 'tinymce') . '/includes/jscripts/tiny_mce/tiny_mce.js');
  //drupal_add_js(drupal_get_path('module', 'tinymce') . '/imce/imce_set.js');
  
  if ($editor_mode==0) { drupal_add_js(drupal_get_path('module', 'tinymce') . '/themes/tinymce_full.js'); }
  elseif ($editor_mode==1) { drupal_add_js(drupal_get_path('module', 'tinymce') . '/themes/tinymce_compact.js'); }
  else { drupal_add_js(drupal_get_path('module', 'tinymce') . '/themes/tinymce_simple.js'); }
  
}

